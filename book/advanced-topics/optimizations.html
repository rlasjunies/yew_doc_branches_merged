<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Optimizations &amp; Best Practices</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../getting-started/project-setup/index.html"><strong aria-hidden="true">2.</strong> Project Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/project-setup/using-wasm-pack.html"><strong aria-hidden="true">2.1.</strong> Using wasm-pack</a></li><li class="chapter-item expanded "><a href="../getting-started/project-setup/using-wasm-bindgen.html"><strong aria-hidden="true">2.2.</strong> Using wasm-bindgen</a></li><li class="chapter-item expanded "><a href="../getting-started/project-setup/using-cargo-web.html"><strong aria-hidden="true">2.3.</strong> Using cargo-web</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/starter-templates.html"><strong aria-hidden="true">3.</strong> Starter Templates</a></li><li class="chapter-item expanded "><a href="../getting-started/build-a-sample-app.html"><strong aria-hidden="true">4.</strong> Build a Sample App</a></li><li class="chapter-item expanded "><a href="../getting-started/choose-web-library.html"><strong aria-hidden="true">5.</strong> Choose web-sys or stdweb</a></li><li class="chapter-item expanded "><a href="../getting-started/examples.html"><strong aria-hidden="true">6.</strong> Learn through examples</a></li><li class="chapter-item expanded "><a href="../concepts/html/index.html"><strong aria-hidden="true">7.</strong> Using html!</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/html/lists.html"><strong aria-hidden="true">7.1.</strong> Lists</a></li><li class="chapter-item expanded "><a href="../concepts/html/elements.html"><strong aria-hidden="true">7.2.</strong> Elements</a></li><li class="chapter-item expanded "><a href="../concepts/html/literals-and-expressions.html"><strong aria-hidden="true">7.3.</strong> Literals &amp; Expressions</a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/components/index.html"><strong aria-hidden="true">8.</strong> Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/components/internalstate.html"><strong aria-hidden="true">8.1.</strong> Internal State</a></li><li class="chapter-item expanded "><a href="../concepts/components/trapevents.html"><strong aria-hidden="true">8.2.</strong> Listen to events</a></li><li class="chapter-item expanded "><a href="../concepts/components/properties.html"><strong aria-hidden="true">8.3.</strong> Properties</a></li><li class="chapter-item expanded "><a href="../concepts/components/emitevents.html"><strong aria-hidden="true">8.4.</strong> Emit events</a></li><li class="chapter-item expanded "><a href="../concepts/components/nestedcomponents.html"><strong aria-hidden="true">8.5.</strong> Nested component</a></li><li class="chapter-item expanded "><a href="../concepts/components/refs.html"><strong aria-hidden="true">8.6.</strong> Refs</a></li><li class="chapter-item expanded "><a href="../concepts/components/styling.html"><strong aria-hidden="true">8.7.</strong> Styling</a></li><li class="chapter-item expanded "><a href="../concepts/components/lifecycle.html"><strong aria-hidden="true">8.8.</strong> Lifecycle</a></li><li class="chapter-item expanded "><a href="../concepts/components/callbacks.html"><strong aria-hidden="true">8.9.</strong> Callbacks</a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/agents.html"><strong aria-hidden="true">9.</strong> Agents</a></li><li class="chapter-item expanded "><a href="../concepts/services/index.html"><strong aria-hidden="true">10.</strong> Services</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/services/format.html"><strong aria-hidden="true">10.1.</strong> Format</a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/router.html"><strong aria-hidden="true">11.</strong> Router</a></li><li class="chapter-item expanded "><a href="../advanced-topics/optimizations.html" class="active"><strong aria-hidden="true">12.</strong> Optimizations &amp; Best Practices</a></li><li class="chapter-item expanded "><a href="../advanced-topics/how-it-works.html"><strong aria-hidden="true">13.</strong> Low-level library internals</a></li><li class="chapter-item expanded "><a href="../more/roadmap.html"><strong aria-hidden="true">14.</strong> Roadmap</a></li><li class="chapter-item expanded "><a href="../more/testing.html"><strong aria-hidden="true">15.</strong> Testing</a></li><li class="chapter-item expanded "><a href="../more/debugging.html"><strong aria-hidden="true">16.</strong> Debugging</a></li><li class="chapter-item expanded "><a href="../more/external-libs.html"><strong aria-hidden="true">17.</strong> External Libs</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h2><a class="header" href="#description-make-your-app-faster" id="description-make-your-app-faster">description: Make your app faster.</a></h2>
<h1><a class="header" href="#optimizations--best-practices" id="optimizations--best-practices">Optimizations &amp; Best Practices</a></h1>
<h2><a class="header" href="#neq_assign" id="neq_assign">neq_assign</a></h2>
<p>When a component receives props from its parent component, the <code>change</code> method is called. This, in addition to allowing you to update the component's state, also allows you to return a <code>ShouldRender</code> boolean value that indicates if the component should re-render itself in response to the prop changes.</p>
<p>Re-rendering is expensive, and if you can avoid it, you should. As a general rule, you only want to re-render when the props actually changed. The following block of code represents this rule, returning <code>true</code> if the props differed from the previous props:</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>use yew::ShouldRender;

#[derive(PartialEq)]
struct ExampleProps;

struct Example {
    props: ExampleProps,
};

impl Example {
    fn change(&amp;mut self, props: ExampleProps) -&gt; ShouldRender {
        if self.props != props {
            self.props = props;
            true
        } else {
            false
        }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>But we can go further! This is six lines of boilerplate can be reduced down to one by using a trait and a blanket implementation for anything that implements <code>PartialEq</code>. Check out the <code>yewtil</code> crate's <code>NeqAssign</code> trait <a href="https://docs.rs/yewtil/*/yewtil/trait.NeqAssign.html">here</a>.</p>
<h2><a class="header" href="#rc" id="rc">RC</a></h2>
<p>In an effort to avoid cloning large chunks of data to create props when re-rendering, we can use smart pointers to only clone the pointer instead. If you use <code>Rc&lt;_&gt;</code>s in your props and child components instead of plain unboxed values, you can delay cloning until you need to modify the data in the child component, where you use <code>Rc::make_mut</code> to clone and get a mutable reference to the data you want to alter. By not cloning until mutation, child components can reject props identical to their state-owned props in <code>Component::change</code> for almost no performance cost, versus the case where the data itself needs to be copied into the props struct in the parent before it is compared and rejected in the child.</p>
<p>This optimization is most useful for data types that aren't <code>Copy</code>. If you can copy your data easily, then it probably isn't worth putting it behind a smart pointer. For structures that can contain lots of data like <code>Vec</code>, <code>HashMap</code>, and <code>String</code>, this optimization should be worthwhile.</p>
<p>This optimization works best if the values are never updated by the children, and even better, if they are rarely updated by parents. This makes <code>Rc&lt;_&gt;s</code> a good choice for wrapping property values in for pure components.</p>
<h2><a class="header" href="#view-functions" id="view-functions">View Functions</a></h2>
<p>For code readability reasons, it often makes sense to migrate sections of <code>html!</code> to their own functions so you can avoid the rightward drift present in deeply nested HTML.</p>
<h2><a class="header" href="#pure-componentsfunction-components" id="pure-componentsfunction-components">Pure Components/Function Components</a></h2>
<p>Pure components are components that don't mutate their state, only displaying content and propagating messages up to normal, mutable components. They differ from view functions in that they can be used from within the <code>html!</code> macro using the component syntax (<code>&lt;SomePureComponent /&gt;</code>) instead of expression syntax (<code>{some_view_function()}</code>), and that depending on their implementation, they can be memoized - preventing re-renders for identical props using aforementioned <code>neq_assign</code> logic.</p>
<p>Yew doesn't natively support pure or function components, but they are available via external crates.</p>
<p>Function components don't exist yet, but in theory, pure components could be generated by using proc macros and annotating functions.</p>
<h2><a class="header" href="#keyed-dom-nodes-when-they-arrive" id="keyed-dom-nodes-when-they-arrive">Keyed DOM nodes when they arrive</a></h2>
<h2><a class="header" href="#compile-speed-optimizations-using-cargo-workspaces" id="compile-speed-optimizations-using-cargo-workspaces">Compile speed optimizations using Cargo Workspaces</a></h2>
<p>Arguabley, the largest drawback to using Yew is the long time it takes to compile. Compile time seems to correlate with the quantity of code found within <code>html!</code> macro blocks. This tends to not be a significant problem for smaller projects, but for webapps that span multiple pages, it makes sense to break apart your code across multiple crates to minimize the amount of work the compiler has to do.</p>
<p>You should try to make your main crate handle routing/page selection, move all commonly shared code to another crate, and then make a different crate for each page, where each page could be a different component, or just a big function that produces <code>Html</code>. In the best case scenario, you go from rebuilding all of your code on each compile to rebuilding only the main crate, and one of your page crates. In the worst case, where you edit something in the &quot;common&quot; crate, you will be right back to where you started: compiling all code that depends on that commonly shared crate, which is probably everything else.</p>
<p>If your main crate is too heavyweight, or you want to rapidly iterate on a deeply nested page (eg. a page that renders on top of another page), you can use an example crate to create a more simple implementation of the main page and render your work-in-progress component on top of that.</p>
<h2><a class="header" href="#build-size-optimization" id="build-size-optimization">Build size optimization</a></h2>
<ul>
<li>optimize Rust code
<ul>
<li><code>wee_aloc</code> ( using tiny allocator )</li>
<li><code>cargo.toml</code> ( defining release profile )</li>
</ul>
</li>
<li>optimize wasm code using <code>wasm-opt</code></li>
</ul>
<p>More information about code size profiling: <a href="https://rustwasm.github.io/book/reference/code-size.html#optimizing-builds-for-code-size">rustwasm book</a></p>
<h3><a class="header" href="#wee_alloc" id="wee_alloc">wee_alloc</a></h3>
<p><a href="https://github.com/rustwasm/wee_alloc">wee_alloc</a> is a tiny allocator that is much smaller than the allocator that is normally used in Rust binaries. Replacing the default allocator with this one will result in smaller WASM file sizes, at the expense of speed and memory overhead.</p>
<p>The slower speed and memory overhead are minor in comparison to the size gains made by not including the default allocator. This smaller file size means that your page will load faster, and so it is generally recommended that you use this allocator over the default, unless your app is doing some allocation-heavy work.</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>// Use `wee_alloc` as the global allocator.
#[global_allocator]
static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#cargotoml" id="cargotoml">Cargo.toml</a></h3>
<p>It is possible to setup release build for smaller size using <code>[profile.release]</code> section in <code>Cargo.toml</code></p>
<p><a href="https://doc.rust-lang.org/cargo/reference/profiles.html">Rust profiles documentation</a></p>
<pre><code class="language-text">[profile.release]
# less code to include into binary
panic = 'abort' 
# optimization over all codebase ( better optimization, slower build )
codegen-units = 1
# optimization for size ( more aggresive )
opt-level = 'z' 
# optimization for size 
# opt-level = 's' 
# link time optimization using using whole-program analysis
lto = true
</code></pre>
<h3><a class="header" href="#wasm-opt" id="wasm-opt">wasm-opt</a></h3>
<p>Further more it is possible to optimize size of <code>wasm</code> code.</p>
<p>wasm-opt info: <a href="https://github.com/WebAssembly/binaryen">binaryen project</a></p>
<p>The Rust Wasm book features a section about reducing the size of WASM binaries: <a href="https://rustwasm.github.io/book/game-of-life/code-size.html">Shrinking .wasm size</a></p>
<ul>
<li>using <code>wasm-pack</code> which by default optimizes <code>wasm</code> code in release builds</li>
<li>using <code>wasm-opt</code> directly on <code>wasm</code> files.</li>
</ul>
<pre><code class="language-text">wasm-opt wasm_bg.wasm -Os -o wasm_bg_opt.wasm
</code></pre>
<h4><a class="header" href="#build-size-of-minimal-example-in-yewexamples" id="build-size-of-minimal-example-in-yewexamples">Build size of 'minimal' example in yew/examples/</a></h4>
<p>Note: <code>wasm-pack</code> combines optimization for Rust and wasm code. <code>wasm-bindgen</code> is in this example without any <code>Rust</code> size optimization.</p>
<table><thead><tr><th align="left">used tool</th><th align="left">size</th></tr></thead><tbody>
<tr><td align="left">wasm-bindgen</td><td align="left">158KB</td></tr>
<tr><td align="left">wasm-binggen + wasm-opt -Os</td><td align="left">116KB</td></tr>
<tr><td align="left">wasm-pack</td><td align="left">99 KB</td></tr>
</tbody></table>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../concepts/router.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../advanced-topics/how-it-works.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../concepts/router.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../advanced-topics/how-it-works.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        
        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3001");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
